!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.ES6Promise=b()}(this,function(){"use strict";function a(a){var b=typeof a;return null!==a&&("object"===b||"function"===b)}function b(a){return"function"==typeof a}function c(a){U=a}function d(a){V=a}function e(){return function(){return process.nextTick(j)}}function f(){return void 0!==T?function(){T(j)}:i()}function g(){var a=0,b=new Y(j),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function h(){var a=new MessageChannel;return a.port1.onmessage=j,function(){return a.port2.postMessage(0)}}function i(){var a=setTimeout;return function(){return a(j,1)}}function j(){for(var a=0;a<S;a+=2){(0,_[a])(_[a+1]),_[a]=void 0,_[a+1]=void 0}S=0}function k(){try{var a=require,b=a("vertx");return T=b.runOnLoop||b.runOnContext,f()}catch(c){return i()}}function l(a,b){var c=arguments,d=this,e=new this.constructor(n);void 0===e[ba]&&G(e);var f=d._state;return f?function(){var a=c[f-1];V(function(){return D(f,e,a,d._result)})}():z(d,e,a,b),e}function m(a){var b=this;if(a&&"object"==typeof a&&a.constructor===b)return a;var c=new b(n);return v(c,a),c}function n(){}function o(){return new TypeError("You cannot resolve a promise with itself")}function p(){return new TypeError("A promises callback cannot return that same promise.")}function q(a){try{return a.then}catch(b){return fa.error=b,fa}}function r(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function s(a,b,c){V(function(a){var d=!1,e=r(c,b,function(c){d||(d=!0,b!==c?v(a,c):x(a,c))},function(b){d||(d=!0,y(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,y(a,e))},a)}function t(a,b){b._state===da?x(a,b._result):b._state===ea?y(a,b._result):z(b,void 0,function(b){return v(a,b)},function(b){return y(a,b)})}function u(a,c,d){c.constructor===a.constructor&&d===l&&c.constructor.resolve===m?t(a,c):d===fa?(y(a,fa.error),fa.error=null):void 0===d?x(a,c):b(d)?s(a,c,d):x(a,c)}function v(b,c){b===c?y(b,o()):a(c)?u(b,c,q(c)):x(b,c)}function w(a){a._onerror&&a._onerror(a._result),A(a)}function x(a,b){a._state===ca&&(a._result=b,a._state=da,0!==a._subscribers.length&&V(A,a))}function y(a,b){a._state===ca&&(a._state=ea,a._result=b,V(w,a))}function z(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+da]=c,e[f+ea]=d,0===f&&a._state&&V(A,a)}function A(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d=void 0,e=void 0,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?D(c,d,e,f):e(f);a._subscribers.length=0}}function B(){this.error=null}function C(a,b){try{return a(b)}catch(c){return ga.error=c,ga}}function D(a,c,d,e){var f=b(d),g=void 0,h=void 0,i=void 0,j=void 0;if(f){if(g=C(d,e),g===ga?(j=!0,h=g.error,g.error=null):i=!0,c===g)return void y(c,p())}else g=e,i=!0;c._state!==ca||(f&&i?v(c,g):j?y(c,h):a===da?x(c,g):a===ea&&y(c,g))}function E(a,b){try{b(function(b){v(a,b)},function(b){y(a,b)})}catch(c){y(a,c)}}function F(){return ha++}function G(a){a[ba]=ha++,a._state=void 0,a._result=void 0,a._subscribers=[]}function H(a,b){this._instanceConstructor=a,this.promise=new a(n),this.promise[ba]||G(this.promise),R(b)?(this.length=b.length,this._remaining=b.length,this._result=new Array(this.length),0===this.length?x(this.promise,this._result):(this.length=this.length||0,this._enumerate(b),0===this._remaining&&x(this.promise,this._result))):y(this.promise,I())}function I(){return new Error("Array Methods must be provided an Array")}function J(a){return new H(this,a).promise}function K(a){var b=this;return new b(R(a)?function(c,d){for(var e=a.length,f=0;f<e;f++)b.resolve(a[f]).then(c,d)}:function(a,b){return b(new TypeError("You must pass an array to race."))})}function L(a){var b=this,c=new b(n);return y(c,a),c}function M(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function N(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function O(a){this[ba]=F(),this._result=this._state=void 0,this._subscribers=[],n!==a&&("function"!=typeof a&&M(),this instanceof O?E(this,a):N())}function P(){var a=void 0;if("undefined"!=typeof global)a=global;else if("undefined"!=typeof self)a=self;else try{a=Function("return this")()}catch(d){throw new Error("polyfill failed because global object is unavailable in this environment")}var b=a.Promise;if(b){var c=null;try{c=Object.prototype.toString.call(b.resolve())}catch(d){}if("[object Promise]"===c&&!b.cast)return}a.Promise=O}var Q=void 0;Q=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var R=Q,S=0,T=void 0,U=void 0,V=function(a,b){_[S]=a,_[S+1]=b,2===(S+=2)&&(U?U(j):aa())},W="undefined"!=typeof window?window:void 0,X=W||{},Y=X.MutationObserver||X.WebKitMutationObserver,Z="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),$="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,_=new Array(1e3),aa=void 0;aa=Z?e():Y?g():$?h():void 0===W&&"function"==typeof require?k():i();var ba=Math.random().toString(36).substring(16),ca=void 0,da=1,ea=2,fa=new B,ga=new B,ha=0;return H.prototype._enumerate=function(a){for(var b=0;this._state===ca&&b<a.length;b++)this._eachEntry(a[b],b)},H.prototype._eachEntry=function(a,b){var c=this._instanceConstructor,d=c.resolve;if(d===m){var e=q(a);if(e===l&&a._state!==ca)this._settledAt(a._state,b,a._result);else if("function"!=typeof e)this._remaining--,this._result[b]=a;else if(c===O){var f=new c(n);u(f,a,e),this._willSettleAt(f,b)}else this._willSettleAt(new c(function(b){return b(a)}),b)}else this._willSettleAt(d(a),b)},H.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===ca&&(this._remaining--,a===ea?y(d,c):this._result[b]=c),0===this._remaining&&x(d,this._result)},H.prototype._willSettleAt=function(a,b){var c=this;z(a,void 0,function(a){return c._settledAt(da,b,a)},function(a){return c._settledAt(ea,b,a)})},O.all=J,O.race=K,O.resolve=m,O.reject=L,O._setScheduler=c,O._setAsap=d,O._asap=V,O.prototype={constructor:O,then:l,catch:function(a){return this.then(null,a)}},O.polyfill=P,O.Promise=O,O.polyfill(),O}),function(){function a(b,d){function f(a){if(f[a]!==q)return f[a];var b;if("bug-string-char-index"==a)b="a"!="a"[0];else if("json"==a)b=f("json-stringify")&&f("json-parse");else{var c,e='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==a){var i=d.stringify,k="function"==typeof i&&t;if(k){(c=function(){return 1}).toJSON=c;try{k="0"===i(0)&&"0"===i(new g)&&'""'==i(new h)&&i(s)===q&&i(q)===q&&i()===q&&"1"===i(c)&&"[1]"==i([c])&&"[null]"==i([q])&&"null"==i(null)&&"[null,null,null]"==i([q,s,null])&&i({a:[c,!0,!1,null,"\0\b\n\f\r\t"]})==e&&"1"===i(null,c)&&"[\n 1,\n 2\n]"==i([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==i(new j(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==i(new j(864e13))&&'"-000001-01-01T00:00:00.000Z"'==i(new j(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==i(new j(-1))}catch(n){k=!1}}b=k}if("json-parse"==a){var l=d.parse;if("function"==typeof l)try{if(0===l("0")&&!l(!1)){c=l(e);var m=5==c.a.length&&1===c.a[0];if(m){try{m=!l('"\t"')}catch(n){}if(m)try{m=1!==l("01")}catch(n){}if(m)try{m=1!==l("1.")}catch(n){}}}}catch(n){m=!1}b=m}}return f[a]=!!b}b||(b=e.Object()),d||(d=e.Object());var g=b.Number||e.Number,h=b.String||e.String,i=b.Object||e.Object,j=b.Date||e.Date,k=b.SyntaxError||e.SyntaxError,l=b.TypeError||e.TypeError,m=b.Math||e.Math,n=b.JSON||e.JSON;"object"==typeof n&&n&&(d.stringify=n.stringify,d.parse=n.parse);var o,p,q,r=i.prototype,s=r.toString,t=new j(-0xc782b5b800cec);try{t=-109252==t.getUTCFullYear()&&0===t.getUTCMonth()&&1===t.getUTCDate()&&10==t.getUTCHours()&&37==t.getUTCMinutes()&&6==t.getUTCSeconds()&&708==t.getUTCMilliseconds()}catch(T){}if(!f("json")){var u="[object Function]",v="[object Date]",w="[object Number]",x="[object String]",y="[object Array]",z="[object Boolean]",A=f("bug-string-char-index");if(!t)var B=m.floor,C=[0,31,59,90,120,151,181,212,243,273,304,334],D=function(a,b){return C[b]+365*(a-1970)+B((a-1969+(b=+(b>1)))/4)-B((a-1901+b)/100)+B((a-1601+b)/400)};if((o=r.hasOwnProperty)||(o=function(a){var b,c={};return(c.__proto__=null,c.__proto__={toString:1},c).toString!=s?o=function(a){var b=this.__proto__,c=a in(this.__proto__=null,this);return this.__proto__=b,c}:(b=c.constructor,o=function(a){var c=(this.constructor||b).prototype;return a in this&&!(a in c&&this[a]===c[a])}),c=null,o.call(this,a)}),p=function(a,b){var d,e,f,g=0;(d=function(){this.valueOf=0}).prototype.valueOf=0,e=new d;for(f in e)o.call(e,f)&&g++;return d=e=null,g?p=2==g?function(a,b){var c,d={},e=s.call(a)==u;for(c in a)e&&"prototype"==c||o.call(d,c)||!(d[c]=1)||!o.call(a,c)||b(c)}:function(a,b){var c,d,e=s.call(a)==u;for(c in a)e&&"prototype"==c||!o.call(a,c)||(d="constructor"===c)||b(c);(d||o.call(a,c="constructor"))&&b(c)}:(e=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],p=function(a,b){var d,f,g=s.call(a)==u,h=!g&&"function"!=typeof a.constructor&&c[typeof a.hasOwnProperty]&&a.hasOwnProperty||o;for(d in a)g&&"prototype"==d||!h.call(a,d)||b(d);for(f=e.length;d=e[--f];h.call(a,d)&&b(d));}),p(a,b)},!f("json-stringify")){var E={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},F="000000",G=function(a,b){return(F+(b||0)).slice(-a)},H="\\u00",I=function(a){for(var b='"',c=0,d=a.length,e=!A||d>10,f=e&&(A?a.split(""):a);c<d;c++){var g=a.charCodeAt(c);switch(g){case 8:case 9:case 10:case 12:case 13:case 34:case 92:b+=E[g];break;default:if(g<32){b+=H+G(2,g.toString(16));break}b+=e?f[c]:a.charAt(c)}}return b+'"'},J=function(a,b,c,d,e,f,g){var h,i,j,k,m,n,r,t,u,A,C,E,F,H,K,L;try{h=b[a]}catch(T){}if("object"==typeof h&&h)if((i=s.call(h))!=v||o.call(h,"toJSON"))"function"==typeof h.toJSON&&(i!=w&&i!=x&&i!=y||o.call(h,"toJSON"))&&(h=h.toJSON(a));else if(h>-1/0&&h<1/0){if(D){for(m=B(h/864e5),j=B(m/365.2425)+1970-1;D(j+1,0)<=m;j++);for(k=B((m-D(j,0))/30.42);D(j,k+1)<=m;k++);m=1+m-D(j,k),n=(h%864e5+864e5)%864e5,r=B(n/36e5)%24,t=B(n/6e4)%60,u=B(n/1e3)%60,A=n%1e3}else j=h.getUTCFullYear(),k=h.getUTCMonth(),m=h.getUTCDate(),r=h.getUTCHours(),t=h.getUTCMinutes(),u=h.getUTCSeconds(),A=h.getUTCMilliseconds();h=(j<=0||j>=1e4?(j<0?"-":"+")+G(6,j<0?-j:j):G(4,j))+"-"+G(2,k+1)+"-"+G(2,m)+"T"+G(2,r)+":"+G(2,t)+":"+G(2,u)+"."+G(3,A)+"Z"}else h=null;if(c&&(h=c.call(b,a,h)),null===h)return"null";if((i=s.call(h))==z)return""+h;if(i==w)return h>-1/0&&h<1/0?""+h:"null";if(i==x)return I(""+h);if("object"==typeof h){for(H=g.length;H--;)if(g[H]===h)throw l();if(g.push(h),C=[],K=f,f+=e,i==y){for(F=0,H=h.length;F<H;F++)E=J(F,h,c,d,e,f,g),C.push(E===q?"null":E);L=C.length?e?"[\n"+f+C.join(",\n"+f)+"\n"+K+"]":"["+C.join(",")+"]":"[]"}else p(d||h,function(a){var b=J(a,h,c,d,e,f,g);b!==q&&C.push(I(a)+":"+(e?" ":"")+b)}),L=C.length?e?"{\n"+f+C.join(",\n"+f)+"\n"+K+"}":"{"+C.join(",")+"}":"{}";return g.pop(),L}};d.stringify=function(a,b,d){var e,f,g,h;if(c[typeof b]&&b)if((h=s.call(b))==u)f=b;else if(h==y){g={};for(var i,j=0,k=b.length;j<k;i=b[j++],((h=s.call(i))==x||h==w)&&(g[i]=1));}if(d)if((h=s.call(d))==w){if((d-=d%1)>0)for(e="",d>10&&(d=10);e.length<d;e+=" ");}else h==x&&(e=d.length<=10?d:d.slice(0,10));return J("",(i={},i[""]=a,i),f,g,e,"",[])}}if(!f("json-parse")){var K,L,M=h.fromCharCode,N={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},O=function(){throw K=L=null,k()},P=function(){for(var a,b,c,d,e,f=L,g=f.length;K<g;)switch(e=f.charCodeAt(K)){case 9:case 10:case 13:case 32:K++;break;case 123:case 125:case 91:case 93:case 58:case 44:return a=A?f.charAt(K):f[K],K++,a;case 34:for(a="@",K++;K<g;)if((e=f.charCodeAt(K))<32)O();else if(92==e)switch(e=f.charCodeAt(++K)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:a+=N[e],K++;break;case 117:for(b=++K,c=K+4;K<c;K++)(e=f.charCodeAt(K))>=48&&e<=57||e>=97&&e<=102||e>=65&&e<=70||O();a+=M("0x"+f.slice(b,K));break;default:O()}else{if(34==e)break;for(e=f.charCodeAt(K),b=K;e>=32&&92!=e&&34!=e;)e=f.charCodeAt(++K);a+=f.slice(b,K)}if(34==f.charCodeAt(K))return K++,a;O();default:if(b=K,45==e&&(d=!0,e=f.charCodeAt(++K)),e>=48&&e<=57){for(48==e&&(e=f.charCodeAt(K+1))>=48&&e<=57&&O(),d=!1;K<g&&(e=f.charCodeAt(K))>=48&&e<=57;K++);if(46==f.charCodeAt(K)){for(c=++K;c<g&&(e=f.charCodeAt(c))>=48&&e<=57;c++);c==K&&O(),K=c}if(101==(e=f.charCodeAt(K))||69==e){for(e=f.charCodeAt(++K),43!=e&&45!=e||K++,c=K;c<g&&(e=f.charCodeAt(c))>=48&&e<=57;c++);c==K&&O(),K=c}return+f.slice(b,K)}if(d&&O(),"true"==f.slice(K,K+4))return K+=4,!0;if("false"==f.slice(K,K+5))return K+=5,!1;if("null"==f.slice(K,K+4))return K+=4,null;O()}return"$"},Q=function(a){var b,c;if("$"==a&&O(),"string"==typeof a){if("@"==(A?a.charAt(0):a[0]))return a.slice(1);if("["==a){for(b=[];"]"!=(a=P());c||(c=!0))c&&(","==a?"]"==(a=P())&&O():O()),","==a&&O(),b.push(Q(a));return b}if("{"==a){for(b={};"}"!=(a=P());c||(c=!0))c&&(","==a?"}"==(a=P())&&O():O()),","!=a&&"string"==typeof a&&"@"==(A?a.charAt(0):a[0])&&":"==P()||O(),b[a.slice(1)]=Q(P());return b}O()}return a},R=function(a,b,c){var d=S(a,b,c);d===q?delete a[b]:a[b]=d},S=function(a,b,c){var d,e=a[b];if("object"==typeof e&&e)if(s.call(e)==y)for(d=e.length;d--;)R(e,d,c);else p(e,function(a){R(e,a,c)});return c.call(a,b,e)};d.parse=function(a,b){var c,d;return K=0,L=""+a,c=Q(P()),"$"!=P()&&O(),K=L=null,b&&s.call(b)==u?S((d={},d[""]=c,d),"",b):c}}}return d.runInContext=a,d}var b="function"==typeof define&&define.amd,c={function:!0,object:!0},d=c[typeof exports]&&exports&&!exports.nodeType&&exports,e=c[typeof window]&&window||this,f=d&&c[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(!f||f.global!==f&&f.window!==f&&f.self!==f||(e=f),d&&!b)a(e,d);else{var g=e.JSON,h=e.JSON3,i=!1,j=a(e,e.JSON3={noConflict:function(){return i||(i=!0,e.JSON=g,e.JSON3=h,g=h=null),j}});e.JSON={parse:j.parse,stringify:j.stringify}}b&&define(function(){return j})}.call(this),function(a){"use strict";function b(a){if("string"!=typeof a&&(a=String(a)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(a))throw new TypeError("Invalid character in header field name");return a.toLowerCase()}function c(a){return"string"!=typeof a&&(a=String(a)),a}function d(a){this.map={},a instanceof d?a.forEach(function(a,b){this.append(b,a)},this):a&&Object.getOwnPropertyNames(a).forEach(function(b){this.append(b,a[b])},this)}function e(a){if(a.bodyUsed)return Promise.reject(new TypeError("Already read"));a.bodyUsed=!0}function f(a){return new Promise(function(b,c){a.onload=function(){b(a.result)},a.onerror=function(){c(a.error)}})}function g(a){var b=new FileReader;return b.readAsArrayBuffer(a),f(b)}function h(a,b){var c=new FileReader,d=b.headers.map["content-type"]?b.headers.map["content-type"].toString():"",e=/charset\=[0-9a-zA-Z\-\_]*;?/,g=a.type.match(e)||d.match(e),h=[a];return g&&h.push(g[0].replace(/^charset\=/,"").replace(/;$/,"")),c.readAsText.apply(c,h),f(c)}function i(){return this.bodyUsed=!1,this._initBody=function(a,b){if(this._bodyInit=a,"string"==typeof a)this._bodyText=a;else if(o.blob&&Blob.prototype.isPrototypeOf(a))this._bodyBlob=a,this._options=b;else if(o.formData&&FormData.prototype.isPrototypeOf(a))this._bodyFormData=a;else if(a){if(!o.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(a))throw new Error("unsupported BodyInit type")}else this._bodyText=""},o.blob?(this.blob=function(){var a=e(this);if(a)return a;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(g)},this.text=function(){var a=e(this);if(a)return a;if(this._bodyBlob)return h(this._bodyBlob,this._options);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var a=e(this);return a||Promise.resolve(this._bodyText)},o.formData&&(this.formData=function(){return this.text().then(l)}),this.json=function(){return this.text().then(JSON.parse)},this}function j(a){var b=a.toUpperCase();return p.indexOf(b)>-1?b:a}function k(a,b){b=b||{};var c=b.body;if(k.prototype.isPrototypeOf(a)){if(a.bodyUsed)throw new TypeError("Already read");this.url=a.url,this.credentials=a.credentials,b.headers||(this.headers=new d(a.headers)),this.method=a.method,this.mode=a.mode,c||(c=a._bodyInit,a.bodyUsed=!0)}else this.url=a;if(this.credentials=b.credentials||this.credentials||"omit",!b.headers&&this.headers||(this.headers=new d(b.headers)),this.method=j(b.method||this.method||"GET"),this.mode=b.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&c)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(c,b)}function l(a){var b=new FormData;return a.trim().split("&").forEach(function(a){if(a){var c=a.split("="),d=c.shift().replace(/\+/g," "),e=c.join("=").replace(/\+/g," ");b.append(decodeURIComponent(d),decodeURIComponent(e))}}),b}function m(a){var b=new d;return a.getAllResponseHeaders().trim().split("\n").forEach(function(a){var c=a.trim().split(":"),d=c.shift().trim(),e=c.join(":").trim();b.append(d,e)}),b}function n(a,b){b||(b={}),this._initBody(a,b),this.type="default",this.status=b.status,this.ok=this.status>=200&&this.status<300,this.statusText=b.statusText,this.headers=b.headers instanceof d?b.headers:new d(b.headers),this.url=b.url||""}if(a.__disableNativeFetch||!a.fetch){d.prototype.append=function(a,d){a=b(a),d=c(d);var e=this.map[a];e||(e=[],this.map[a]=e),e.push(d)},d.prototype.delete=function(a){delete this.map[b(a)]},d.prototype.get=function(a){var c=this.map[b(a)];return c?c[0]:null},d.prototype.getAll=function(a){return this.map[b(a)]||[]},d.prototype.has=function(a){return this.map.hasOwnProperty(b(a))},d.prototype.set=function(a,d){this.map[b(a)]=[c(d)]},d.prototype.forEach=function(a,b){Object.getOwnPropertyNames(this.map).forEach(function(c){this.map[c].forEach(function(d){a.call(b,d,c,this)},this)},this)};var o={blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch(a){return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a},p=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];k.prototype.clone=function(){return new k(this)},i.call(k.prototype),i.call(n.prototype),n.prototype.clone=function(){return new n(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},n.error=function(){var a=new n(null,{status:0,statusText:""});return a.type="error",a};var q=[301,302,303,307,308];n.redirect=function(a,b){if(-1===q.indexOf(b))throw new RangeError("Invalid status code");return new n(null,{status:b,headers:{location:a}})},a.Headers=d,a.Request=k,a.Response=n,a.fetch=function(a,b){return new Promise(function(c,d){function e(){return"responseURL"in h?h.responseURL:/^X-Request-URL:/m.test(h.getAllResponseHeaders())?h.getResponseHeader("X-Request-URL"):void 0}function f(){if(4===h.readyState){var a=1223===h.status?204:h.status;if(a<100||a>599){if(i)return;return i=!0,void d(new TypeError("Network request failed"))}var b={status:a,statusText:h.statusText,headers:m(h),url:e()},f="response"in h?h.response:h.responseText;i||(i=!0,c(new n(f,b)))}}var g;g=k.prototype.isPrototypeOf(a)&&!b?a:new k(a,b);var h=new XMLHttpRequest,i=!1;h.onreadystatechange=f,h.onload=f,h.onerror=function(){i||(i=!0,d(new TypeError("Network request failed")))},h.open(g.method,g.url,!0);try{"include"===g.credentials&&("withCredentials"in h?h.withCredentials=!0:console&&console.warn&&console.warn("withCredentials is not supported, you can ignore this warning"))}catch(j){console&&console.warn&&console.warn("set withCredentials error:"+j)}"responseType"in h&&o.blob&&(h.responseType="blob"),g.headers.forEach(function(a,b){h.setRequestHeader(b,a)}),h.send(void 0===g._bodyInit?null:g._bodyInit)})},a.fetch.polyfill=!0,"undefined"!=typeof module&&module.exports&&(module.exports=a.fetch)}}("undefined"!=typeof self?self:this),function(){function a(a){this.message=a}var b="undefined"!=typeof exports?exports:this,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";a.prototype=new Error,a.prototype.name="InvalidCharacterError",b.btoa||(b.btoa=function(b){for(var d,e,f=0,g=c,h="";b.charAt(0|f)||(g="=",f%1);h+=g.charAt(63&d>>8-f%1*8)){if((e=b.charCodeAt(f+=.75))>255)throw new a("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");d=d<<8|e}return h}),b.atob||(b.atob=function(b){if(b=b.replace(/=+$/,""),b.length%4==1)throw new a("'atob' failed: The string to be decoded is not correctly encoded.");for(var d,e,f=0,g=0,h="";e=b.charAt(g++);~e&&(d=f%4?64*d+e:e,f++%4)?h+=String.fromCharCode(255&d>>(-2*f&6)):0)e=c.indexOf(e);return h})}();var HiPay=function(a){function b(a){try{return null!==document.querySelector(a)}catch(b){return!1}}function c(){var a="button:not([disabled]), input:not([disabled]):not([tabindex='-1'])";if(document.activeElement){if(b(a))var c=Array.prototype.filter.call(document.querySelectorAll(a),function(a){return a.offsetWidth>0||a.offsetHeight>0||a===document.activeElement});else var c=Array.prototype.filter.call(document.querySelectorAll("button, input[data-hipay-tabable='true']"),function(a){return a.offsetWidth>0||a.offsetHeight>0||a===document.activeElement});c[c.indexOf(document.activeElement)+1].focus()}else element.nextElementSibling.focus()}function d(){var a=navigator.userAgent.toLowerCase();return-1!=a.indexOf("msie")&&parseInt(a.split("msie")[1])}function e(){for(var a in o)K(o[a]).disabled=!0}function f(a,b){_(this,{type:"invalid_parameters",code:a,message:b})}var a={};a.Form={},a.Form.locale="en_EN";var g,h={stage:"https://stage-secure2-vault.hipay-tpp.com/rest/v2/token/create.json",production:"https://secure2-vault.hipay-tpp.com/rest/v2/token/create.json"},j={stage:"https://stage-secure-gateway.hipay-tpp.com/rest/v2/available-payment-products",production:"https://stage-secure-gateway.hipay-tpp.com/rest/v2/available-payment-products"},k=" / ",l=30,m={en_EN:{FORM_CVV_3_HELP_MESSAGE:"For security reasons, you have to enter your card security code (CVC). It's the 3-digits number on the back of your card for VISA®, MASTERCARD® and MAESTRO®.",FORM_CVV_4_HELP_MESSAGE:"For security reasons, you have to enter your card security code (CVC). The AMERICAN EXPRESS security code is the 4-digits number on the front of your card.",FORM_ERROR_INVALID_CARD_HOLDER:"The name field must contain maximum %NUMBER% digits.",FORM_ERROR_INVALID_CARD_NUMBER:"Invalid card number.",FORM_ERROR_INVALID_EXPIRY_DATE_PAST:"The expiration date is already past.",FORM_ERROR_INVALID_MONTH_EXPIRY_DATE:"The month field must be between 1 and 12.",FORM_ERROR_INVALID_CVV:"The CVV field must contain %NUMBER% digits.",FORM_ERROR_DEFAULT:"An error occured.",FORM_PLACEHOLDER_CARD_NUMBER:"Ex : 5136 0000 0000 0000",FORM_PLACEHOLDER_CARD_HOLDER:"FirstName LastName",FORM_PLACEHOLDER_CARD_EXPIRY_DATE:"MM"+k+"YY",FORM_PLACEHOLDER_CARD_CVV:"123",FORM_PLACEHOLDER_CARD_CVV_AMEX:"1234"},fr_FR:{FORM_CVV_3_HELP_MESSAGE:"Pour des raisons de sécurité, vous devez indiquer le code de sécurité (CVC). Ce code correspond aux 3 chiffres visibles au verso de votre carte VISA®, MASTERCARD® and MAESTRO®.",FORM_CVV_4_HELP_MESSAGE:"Pour des raisons de sécurité, vous devez indiquer le code de sécurité (CVC). Le code de securité AMERICAN EXPRESS est un nombre à 4 chiffres au recto de votre carte.",FORM_ERROR_INVALID_CARD_HOLDER:"Le champ nom doit contenir au maximum %NUMBER% caractères.",FORM_ERROR_INVALID_CARD_NUMBER:"Numéro de carte invalide.",FORM_ERROR_INVALID_EXPIRY_DATE_PAST:"La date est inférieure à la date actuelle.",FORM_ERROR_INVALID_MONTH_EXPIRY_DATE:"Le mois doit être compris entre 1 et 12.",FORM_ERROR_INVALID_CVV:"Le champ CVV doit contenir %NUMBER% caractères.",FORM_ERROR_DEFAULT:"Une erreur est survenue.",FORM_PLACEHOLDER_CARD_NUMBER:"Ex : 5136 0000 0000 0000",FORM_PLACEHOLDER_CARD_HOLDER:"Prénom Nom",FORM_PLACEHOLDER_CARD_EXPIRY_DATE:"MM"+k+"AA",FORM_PLACEHOLDER_CARD_CVV:"123",FORM_PLACEHOLDER_CARD_CVV_AMEX:"1234"}},n=function(b){return m[a.Form.locale][b]},o={cardNumber:"card-number",cardType:"card-type",cardHolder:"card-holder",cardExpiryDate:"card-expiry-date",cardExpiryMonth:"card-expiry-month",cardExpiryYear:"card-expiry-year",cardCVV:"card-cvv",payButton:"pay-button"},p={visa:"card_visa_info",mastercard:"card_mastercard_info",diners:"card_diners_info","american-express":"card_american_express_info",maestro:"card_maestro_info",bcmc:"card_bcmc_info"},q={card_visa_info:"CVV",card_mastercard_info:"CVC",card_american_express_info:"CID"},r={card_visa_info:"ic_credit_card_visa.png",card_mastercard_info:"ic_credit_card_mastercard.png",card_diners_info:"ic_credit_card_diners.png",card_american_express_info:"ic_credit_card_amex.png",card_maestro_info:"ic_credit_card_maestro.png",card_bcmc_info:"ic_credit_card_bcmc.png"},s=3,t={card_visa_info:{ranges:[{first:4,variable:null}],lengths:{length:16,variable:null},format:[4,4,4]},card_mastercard_info:{ranges:[{first:51,variable:4}],lengths:{length:16,variable:null},format:[4,4,4]},card_diners_info:{ranges:[{first:300,variable:5},{first:38,variable:1},{first:2014,variable:null},{first:2149,variable:null},{first:309,variable:null},{first:36,variable:null}],lengths:{length:14,variable:1},format:[4,6]},card_american_express_info:{ranges:[{first:34,variable:null},{first:37,variable:null}],lengths:{length:15,variable:null},format:[4,6]},card_maestro_info:{ranges:[{first:50,variable:null},{first:56,variable:13}],lengths:{length:12,variable:7},format:[4,4,4,4]},card_bcmc_info:{ranges:[{first:670300,variable:100}],lengths:{length:17},format:[4,4,4,4,1]}},u=new Function("try {return this===window;}catch(e){ return false;}"),v=function(){var a={},b=!1,c=0,d=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(b=arguments[0],c++);for(var e=function(c){for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(b&&"[object Object]"===Object.prototype.toString.call(c[d])?a[d]=extend(!0,a[d],c[d]):a[d]=c[d])};c<d;c++){e(arguments[c])}return a},w=function(a,b){_(this,{code:a,message:b})},x="function"==typeof Object.defineProperty;if(x)try{Object.defineProperty({},"x",{})}catch(la){x=!1}x?Object.defineProperties(a,{allowedParameters:{enumerable:!0,writable:!0,value:{card_number:!0,card_holder:!0,card_expiry_month:!0,card_expiry_year:!0,cvc:!0,multi_use:!0,generate_request_id:!0}},target:{enumerable:!0,writable:!0,value:"production"},username:{enumerable:!1,writable:!0},password:{enumerable:!1,writable:!0}}):allowedParameters={enumerable:!0,writable:!0,value:{card_number:!0,card_holder:!0,card_expiry_month:!0,card_expiry_year:!0,cvc:!0,multi_use:!0,generate_request_id:!0}};var y=function(a,b){for(var c in b)b[c].propertyDescriptors=v({},{enumerable:!0,writable:!1,configurable:!1},b[c].propertyDescriptors||{});var d=v({},a.prototype._mapping||{},b);if(x?Object.defineProperties(a.prototype,{_mapping:{enumerable:!1,configurable:!0,writable:!1,value:d}}):a.prototype._mapping=d,x){var e={};for(var c in b){var f=b[c];e[f.name]=f.propertyDescriptors}Object.defineProperties(a.prototype,e)}},z=function(a){if(x){var b=[];for(var c in a._mapping){var d=a._mapping[c];b[d.name]=v({},!0,d.propertyDescriptors.clone,{writable:!0,configurable:!0})}Object.defineProperties(a,b)}},A=function(a,b){if(a.setSelectionRange)a.focus(),a.setSelectionRange(b,b);else if(a.createTextRange){var c=a.createTextRange();c.collapse(!0),c.moveEnd("character",b),c.moveStart("character",b),c.select()}},B=function(a){var b={start:0,end:0};if("number"==typeof a.selectionStart&&"number"==typeof a.selectionEnd)b.start=a.selectionStart,b.end=a.selectionEnd;else if(document.selection){var c=document.selection.createRange().getBookmark(),d=a.createTextRange(),e=d.duplicate();d.moveToBookmark(c),e.setEndPoint("EndToStart",d),b.start=e.text.length,b.end=b.start+d.text.length}return b},C=null,D=function(a){var b={};b.creditCardHolderLengthMax=60,b.creditCardCVVLengthMax=s,b.cardFormatArray=[],b.getCreditCardHolderInput=function(){return K(o.cardHolder)},b.getCreditCardNumberInput=function(){return K(o.cardNumber)},b.getCreditCardNumberValue=function(){return L(o.cardNumber)},b.getCardFormatArray=function(){},b.getCreditCardCVVLengthMax=function(a){if(void 0===b.creditCardCVVLengthMax||void 0===a||1==a)for(var c=["34","35","36","37"],d=L(o.cardNumber),e=0;e<c.length;e++)""!=d&&void 0!==c[e]&&0===d.indexOf(c[e])&&(b.creditCardCVVLengthMax=4);return b.creditCardCVVLengthMax},b.setCreditCardCVVMaxLength=function(a){s=a},b.getCardTypeId=function(){return b.initInfoCardWithCardNumber(),b.idType},b.getTypeWithCardNumber=function(a){var c;void 0!==a&&(c=a.split(" ").join(""));var d,e=0;for(var f in t)for(var g=0;g<t[f].ranges.length;g++)if(null!=t[f].ranges[g].variable)for(var h=0;h<t[f].ranges[g].variable;h++){var i=t[f].ranges[g].first+h;0===c.indexOf(i)&&(b.idType=f,d=f,e++)}else 0===c.indexOf(t[f].ranges[g].first)&&(b.idType=f,d=f,e++);return d},b.initInfoCardWithCardNumber=function(a){var c,d,e=0;void 0===a&&(a=L(o.cardNumber)),void 0!==a&&(c=a.split(" ").join("")),K(o.cardType)&&(K(o.cardType).src="",K(o.cardType).setAttribute("style","display:none;"),K(o.cardType).setAttribute("style","visibility:hidden;"));for(var f in t)for(var g=0;g<t[f].ranges.length;g++)if(null!=t[f].ranges[g].variable)for(var h=0;h<t[f].ranges[g].variable;h++){var i=t[f].ranges[g].first+h;0===c.indexOf(i)&&(d=f,e++)}else 0===c.indexOf(t[f].ranges[g].first)&&(d=f,e++);d&&(b.idType=d,K(o.cardType)&&(K(o.cardType).src="./img/type/"+r[d],K(o.cardType).setAttribute("style","display:block;"),K(o.cardType).setAttribute("style","visibility:visible;"),P(b.idType)),b.cardFormatArray=t[d].format,b.cardLengthMin=b.cardLengthMax=t[d].lengths.length,null!=t[d].lengths.variable&&(b.cardLengthMax=b.cardLengthMin+t[d].lengths.variable))},b.unformatCreditCardNumber=function(a){return void 0!==a?a.split(" ").join(""):a};var d=function(a){var d=b.validatorCreditCardNumber([]);if(K(o.cardCVV)&&(K(o.cardCVV).disabled=!1),""!=b.cardNumberStringFormatAfter&&"card_bcmc_info"==b.idType){var e=K(o.cardCVV);null!==e&&(e.value="",e.classList.contains("inputdisabled")?e.classList.remove("inputdisabled"):e.classList.add("inputdisabled"),e.disabled=!0)}""!=b.cardNumberStringFormatAfter&&d.isValid(L(o.cardNumber))?c():b.cardLengthMax==b.cardNumberStringAfter.length&&d.isValid(L(o.cardNumber))},e=function(a){var d=b.validatorCreditCardExpiryDate([]),e=4+k.length;L(o.cardExpiryDate)&&e==L(o.cardExpiryDate).length&&!0===d.isValid(L(o.cardExpiryDate))?c():L(o.cardExpiryDate)&&7==L(o.cardExpiryDate).length&&d.isValid(L(o.cardExpiryDate))};return b.validatorCreditCardNumber=function(a){var c={};c.errorCollection=a||[],c.isPotentiallyValid=function(a){var e;void 0!==a&&(e=a.split(" ").join(""));var f=!1,g=[];for(var i in t)for(var j=0;j<t[i].ranges.length;j++)if(null!=t[i].ranges[j].variable)for(var k=0;k<t[i].ranges[j].variable;k++)g.push([t[i].ranges[j].first+k,i]);else g.push([t[i].ranges[j].first,i]);for(var l,m,i,n=23,o=0;o<g.length;o++)if(l=g[o][0].toString(),i=g[o][1].toString(),l&&(m=l.substr(0,Math.min(l.length,a.length)))&&0===a.indexOf(m)){if(n=t[i].lengths.length,null!=t[i].lengths.variable&&(n+=t[i].lengths.variable),e.length<n){f=!0;break}if(e.length==n&&!0===h(e)){f=!0;break}}return void 0!==b.getCardTypeId()&&!1===d(b.getCardTypeId())&&(f=!1),0==f&&c.isValid(a),f},c.isValid=function(a){return void 0!==a&&(a=a.split(" ").join("")),!1===d(b.getCardTypeId())?(c.errorCollection.push(new f(50,n("FORM_ERROR_INVALID_CARD_NUMBER"))),K(o.cardType).setAttribute("style","display:none;"),!1):!1===e(b.getCardTypeId())?(c.errorCollection.push(new f(50,n("FORM_ERROR_INVALID_CARD_NUMBER"))),
!1):/[^0-9-\s]+/.test(a)?(c.errorCollection.push(new f(50,n("FORM_ERROR_INVALID_CARD_NUMBER"))),!1):!1===g(a)?(c.errorCollection.push(new f(50,n("FORM_ERROR_INVALID_CARD_NUMBER"))),!1):!1!==h(a)||(c.errorCollection.push(new f(50,n("FORM_ERROR_INVALID_CARD_NUMBER"))),!1)};var d=function(a){if(0==ea.length&&ga(),0==ea.length)return!0;for(indexEnableProduct in ea)if(p[ea[indexEnableProduct]]==a)return!0;return!1},e=function(a){if(!1===t.hasOwnProperty(a))return!1},g=function(a){return!(a.length<b.cardLengthMin||null!=b.cardLengthMax&&a.length>b.cardLengthMax)},h=function(a){var b=0,c=0,d=!1;a=a.replace(/\D/g,"");for(var e=a.length-1;e>=0;e--){var f=a.charAt(e),c=parseInt(f,10);d&&(c*=2)>9&&(c-=9),b+=c,d=!d}return b%10==0};return c},b.validatorCreditCardHolder=function(a){var c={};return c.errorCollection=a||[],c.isValid=function(a){return""!=a&&void 0!==a&&null!=a&&(!(a&&a.length>b.creditCardHolderLengthMax)||(c.errorCollection.push(new f(50,n("FORM_ERROR_INVALID_CARD_HOLDER").replace("%NUMBER%",b.creditCardHolderLengthMax))),!1))},c.isPotentiallyValid=function(a){var d=!1;return a&&a.length<=b.creditCardHolderLengthMax&&(d=!0),0==d&&c.isValid(a),d},c},b.validatorCreditCardExpiryDate=function(a){var b={};return b.errorCollection=a||[],b.isPotentiallyValid=function(a){var c=!1;if(a){var d=a.split(k);if(d.length<2)d<=12&&(c=!0);else if(2==d.length){var e=d[0],f=d[1];if(f.length<2)e<=12&&f>=1&&(c=!0);else{var g=new Date,h=g.getMonth()+1,i=g.getFullYear(),j="20"+f;j>i&&j<=i+l?c=!0:j==i&&e>=h&&(c=!0)}}return 0==c&&b.isValid(a),c}},b.isValid=function(a){if(void 0===a&&(a=L(o.cardExpiryDate)),!a)return!1;var c=a.split(k);if(2!=c.length)return b.errorCollection.push(new f(50,"format de date non valide")),!1;var d=c[0],e=c[1],g=new Date,h=g.getMonth()+1,i=g.getFullYear();return e="20"+e,d>12?(b.errorCollection.push(new f(50,n("FORM_ERROR_INVALID_MONTH_EXPIRY_DATE"))),!1):e<i||e>i+l?(b.errorCollection.push(new f(50,n("FORM_ERROR_INVALID_EXPIRY_DATE_PAST"))),!1):!(e==i&&d<h||e<i)||(b.errorCollection.push(new f(50,n("FORM_ERROR_INVALID_EXPIRY_DATE_PAST"))),!1)},b},b.validatorCreditCardCVV=function(a,c){var d={};return d.errorCollection=a||[],d.isPotentiallyValid=function(a,c){for(var e=!1,f=["34","35","36","37"],g=0;g<=f.length;g++)""!=L(o.cardNumber)&&0===c.indexOf(f[g])&&(b.creditCardCVVLengthMax=4);return void 0!==a&&""!=a&&a.length<=b.creditCardCVVLengthMax&&(e=!0),"card_maestro_info"==b.idType&&""==a&&(e=!0),0==e&&d.isValid(a),e},d.isValid=function(a){if("card_maestro_info"==b.idType)return!0;if(""==a||void 0===a||null==a)return!1;for(var e=L(o.cardNumber),g=["34","35","36","37"],h=0;h<=g.length;h++)""!=e&&0===e.indexOf(g[h])&&(b.creditCardCVVLengthMax=4);return void 0!==a&&a.length>b.creditCardCVVLengthMax?(d.errorCollection.push(new f(50,n("FORM_ERROR_INVALID_CVV").replace("%NUMBER%",b.creditCardCVVLengthMax))),!1):void 0!==c&&1!=c||void 0==a||!(a.length<b.creditCardCVVLengthMax)||(d.errorCollection.push(new f(50,n("FORM_ERROR_INVALID_CVV").replace("%NUMBER%",b.creditCardCVVLengthMax))),!1)},d},b.validatorCreditCard=function(a){var c={};return c.errorCollection=[],c.isValid=function(a){var d=!1,e=b.validatorCreditCardNumber();return e.isValid(b.unformatCreditCardNumber(a.card_number))||(c.errorCollection.creditCardNumber=e.errorCollection,d=!0),b.validatorCreditCardHolder(c.errorCollection).isValid(a.card_holder)||(d=!0),b.validatorCreditCardExpiryDate(c.errorCollection).isValid(a.card_expiry_date)||(d=!0),b.validatorCreditCardCVV(c.errorCollection).isValid(a.cvc)||(d=!0),!d},c},b.initCreditCardNumber=function(a,c){b.lastCharCode=a,b.lastCharString=void 0===a||""==a||8==a||46==a?"":String.fromCharCode(a),b.lastCharString,b.cardNumberStringFormatBefore=L(o.cardNumber),b.cardNumberStringFormatedBefore=L(o.cardNumber);var e=b.cardNumberStringFormatBefore;b.cardNumberStringUnformatedBefore=e.split(" ").join("");var f=B(K(o.cardNumber)),g=f.start,h=f.end,i=b.cardNumberStringFormatedBefore.substr(0,g),j=i.split(" "),k=j.length-1,l=b.cardNumberStringFormatedBefore.substr(0,h),m=l.split(" "),n=m.length-1,p=parseInt(g)-parseInt(k),q=parseInt(h)-parseInt(n),r=p,s=b.cardNumberStringUnformatedBefore;if(c){var c=c.replace(/[^0-9]/g,"");p>=0&&q>0&&p<q?(s=s.substring(0,p)+c+s.substring(q,s.length),c.length):p>=0&&(s=s.substring(0,p)+""+c+s.substring(p,s.length),c.length),s.length>=25&&(s=s.substring(0,25))}else if(p>=0&&q>0&&p<q)s=s.substring(0,p)+""+s.substring(q,s.length),r;else if(p>0){if(8==a){var u=s.substring(0,parseInt(p)-1),v=s.substring(parseInt(p),s.length);s=u+""+v,r-=1}else if(46==a){var u=s.substring(0,parseInt(p)),v=s.substring(parseInt(p)+1,s.length);s=u+""+v}r}else if(0==p){if(46==a){var u=s.substring(0,parseInt(p)),v=s.substring(parseInt(p)+1,s.length);s=u+""+v}r}for(var w="",x=r,y=0;y<=s.length;y++)y==r&&(8==a||46==a||(c?x+=c.length:(w+=b.lastCharString,x+=1))),w+=s.charAt(y);r=x,b.cardLengthMin=0,b.cardLengthMax=25,b.idType=null;for(var z in t)for(var C=0;C<t[z].ranges.length;C++)if(null!=t[z].ranges[C].variable)for(var D=0;D<t[z].ranges[C].variable;D++){var E=t[z].ranges[C].first+D;if(0===w.indexOf(E)){b.idType=z;K(o.cardNumber);b.cardFormatArray=t[z].format,b.cardLengthMin=b.cardLengthMax=t[z].lengths.length,null!=t[z].lengths.variable&&(b.cardLengthMax=b.cardLengthMin+t[z].lengths.variable);break}}else if(0===w.indexOf(t[z].ranges[C].first)){b.idType=z,b.cardFormatArray=t[z].format,b.cardLengthMin=b.cardLengthMax=t[z].lengths.length,null!=t[z].lengths.variable&&(b.cardLengthMax=b.cardLengthMin+t[z].lengths.variable);break}null==b.cardLengthMax||w.length<=b.cardLengthMax?b.cardNumberStringAfter=w:c?b.cardNumberStringAfter=w.substr(0,b.cardLengthMax):(b.cardNumberStringAfter=b.cardNumberStringUnformatedBefore,r=p);var F="";if(b.cardFormatArray.length>0)for(var G=[],H=0,C=0;C<b.cardFormatArray.length;C++)G[H+b.cardFormatArray[C]]=1,H+=b.cardFormatArray[C];for(var I=0,J=0;J<b.cardNumberStringAfter.length;J++)void 0!==G&&1===G[J]&&(J<r&&(I+=1),F+=" "),F+=b.cardNumberStringAfter.charAt(J);b.cardNumberStringFormatAfter=F;var N=r+I;M(o.cardNumber,b.cardNumberStringFormatAfter),A(K(o.cardNumber),N),d(K(o.cardHolder),b)},b.initCreditCardHolder=function(a,c){b.lastCharCodeCreditCardHolder=a,b.lastCharStringCreditCardHolder=void 0===a||""==a||8==a||46==a?"":String.fromCharCode(a),b.cardHolderStringFormatedBefore=L(o.cardHolder);var d=B(K(o.cardHolder)),e=d.start,f=d.end,g=(b.cardHolderStringFormatedBefore.substr(0,e),b.cardHolderStringFormatedBefore.substr(0,f),parseInt(e)),h=parseInt(f),i=g,j=b.cardHolderStringFormatedBefore;if(c)g>=0&&h>0&&g<h?(j=j.substring(0,g)+c+j.substring(h,j.length),c.length):g>=0&&(j=j.substring(0,g)+""+c+j.substring(g,j.length),c.length);else if(g>=0&&h>0&&g<h)j=j.substring(0,g)+""+j.substring(h,j.length),i;else if(g>0){if(8==a){var k=j.substring(0,parseInt(g)-1),l=j.substring(parseInt(g),j.length);j=k+""+l,i-=1}else if(46==a){var k=j.substring(0,parseInt(g)),l=j.substring(parseInt(g)+1,j.length);j=k+""+l}i}else if(0==g){if(46==a){var k=j.substring(0,parseInt(g)),l=j.substring(parseInt(g)+1,j.length);j=k+""+l}i}for(var m="",n=i,p=0;p<=j.length;p++)p==i&&(8==a||46==a||(c?n+=c.length:(m+=b.lastCharStringCreditCardHolder,n+=1))),m+=j.charAt(p);i=n,null==b.creditCardHolderLengthMax||m.length<=b.creditCardHolderLengthMax?b.cardHolderStringAfter=m:8==a||46==a?b.cardHolderStringAfter=m:c?b.cardHolderStringAfter=m:(b.cardHolderStringAfter=b.cardHolderStringFormatedBefore,i=e),M(o.cardHolder,b.cardHolderStringAfter),A(K(o.cardHolder),i)},b.initCreditCardExpiryDate=function(a,c){b.lastCharCodeCreditCardExpiryDate=a,b.lastCharStringCreditCardExpiryDate=void 0===a||""==a||8==a||46==a?"":String.fromCharCode(a),b.creditCardExpiryDateFormattedBefore=L(o.cardExpiryDate);var d=b.creditCardExpiryDateFormattedBefore;b.creditCardExpiryDateUnformattedBefore=d.split(k).join("");var f=B(K(o.cardExpiryDate)),g=f.start,h=f.end,i=b.creditCardExpiryDateFormattedBefore.substr(0,g),j=i.split(k),l=(j.length-1)*k.length,m=b.creditCardExpiryDateFormattedBefore.substr(0,h),n=m.split(k),p=(n.length-1)*k.length,q=parseInt(g)-parseInt(l),r=parseInt(h)-parseInt(p);g>2&&g<=2+k.length&&(q=2),h>2&&h<=2+k.length&&(r=2);var s=q,t=b.creditCardExpiryDateUnformattedBefore;if(c){var c=c.replace(/[^0-9]/g,"");q>=0&&r>0&&q<r?(t=t.substring(0,q)+c+t.substring(r,t.length),c.length):q>=0&&(t=t.substring(0,q)+""+c+t.substring(q,t.length),c.length),t.length>=4&&(t=t.substring(0,4))}else if(q>=0&&r>0&&q<r)t=t.substring(0,q)+""+t.substring(r,t.length),s;else if(q>0){if(8==a){var u=t.substring(0,parseInt(q)-1),v=t.substring(parseInt(q),t.length);t=u+""+v,s-=1}else if(46==a){var u=t.substring(0,parseInt(q)),v=t.substring(parseInt(q)+1,t.length);t=u+""+v}s}else if(0==q){if(46==a){var u=t.substring(0,parseInt(q)),v=t.substring(parseInt(q)+1,t.length);t=u+""+v}s}for(var w="",x=s,y=0;y<=t.length;y++)y==s&&(8==a||46==a||(w+=b.lastCharStringCreditCardExpiryDate,x+=1)),w+=t.charAt(y);s=x,w.length<=4?b.cardExpiryDateStringAfter=w:(b.cardExpiryDateStringAfter=b.creditCardExpiryDateUnformattedBefore,s=g),1===b.cardExpiryDateStringAfter.length&&8!=a&&46!=a&&b.cardExpiryDateStringAfter.charAt(0)>1&&(b.cardExpiryDateStringAfter="0"+b.cardExpiryDateStringAfter,s+=1),b.cardExpiryDateStringFormattedAfter=b.cardExpiryDateStringAfter,b.cardExpiryDateStringAfter.length>=2&&(b.cardExpiryDateStringFormattedAfter=b.cardExpiryDateStringFormattedAfter.substring(0,2)+k+b.cardExpiryDateStringAfter.substring(2,b.cardExpiryDateStringFormattedAfter.length),8!=a?s+=k.length:s>=2&&(s+=k.length)),M(o.cardExpiryDate,b.cardExpiryDateStringFormattedAfter),A(K(o.cardExpiryDate),s),e(K(o.cardCVV),b)},b.initCreditCardCVV=function(a,c){b.lastCharCodeCreditCardCVV=a,b.lastCharStringCreditCardCVV=void 0===a||""==a||8==a||46==a?"":String.fromCharCode(a),b.cardCVVStringFormatedBefore=L(o.cardCVV);var d=B(K(o.cardCVV)),e=d.start,f=d.end,g=(b.cardCVVStringFormatedBefore.substr(0,e),b.cardCVVStringFormatedBefore.substr(0,f),parseInt(e)),h=parseInt(f),i=g,j=b.cardCVVStringFormatedBefore;if(c){c=c.replace(/[^0-9]/g,""),g>=0&&h>0&&g<h?j=j.substring(0,g)+c+j.substring(h,j.length):g>=0&&(j=j.substring(0,g)+""+c+j.substring(g,j.length),c.length);var e=g+c.length;j.length>=4&&(j=j.substring(0,4))}else if(g>=0&&h>0&&g<h)j=j.substring(0,g)+""+j.substring(h,j.length),i;else if(g>0){if(8==a){var k=j.substring(0,parseInt(g)-1),l=j.substring(parseInt(g),j.length);j=k+""+l,i-=1}else if(46==a){var k=j.substring(0,parseInt(g)),l=j.substring(parseInt(g)+1,j.length);j=k+""+l}i}else if(0==g){if(46==a){var k=j.substring(0,parseInt(g)),l=j.substring(parseInt(g)+1,j.length);j=k+""+l}i}for(var i=e,m="",n=i,p=0;p<=j.length;p++)p==i&&(8==a||46==a||(m+=b.lastCharStringCreditCardCVV,n+=1)),m+=j.charAt(p);i=n;for(var q=["34","35","36","37"],r=L(o.cardNumber),s=0;s<=q.length;s++)""!=r&&0===r.indexOf(q[s])&&(b.creditCardCVVLengthMax=4);null==b.creditCardCVVLengthMax||m.length<=b.creditCardCVVLengthMax?b.cardCVVStringAfter=m:c?b.cardCVVStringAfter=m.substr(0,b.creditCardCVVLengthMax):(b.cardCVVStringAfter=b.cardCVVStringFormatedBefore,i=e),M(o.cardCVV,b.cardCVVStringAfter),A(K(o.cardCVV),i)},b},E=function(a,b){if(a){"string"==typeof a?a=document.querySelectorAll(a):a.tagName&&(a=[a]);for(var c=0;c<a.length;c++)(" "+a[c].className+" ").indexOf(" "+b+" ")<0&&(a[c].className+=" "+b)}},F=function(a,b){if(a){"string"==typeof a?a=document.querySelectorAll(a):a.tagName&&(a=[a]);for(var c=new RegExp("(^| )"+b+"($| )","g"),d=0;d<a.length;d++)a[d].className=a[d].className.replace(c," ")}},G=function(a,b){if(a){"string"==typeof a?a=document.querySelectorAll(a):a.tagName&&(a=[a]);for(var c=!1,d=0;d<a.length;d++)(" "+a[d].className+" ").indexOf(" "+b+" ")>0&&(c=!0);return c}},H=new Function,I=function(b){for(var c in o)"cardType"!=c&&null!=K(o[c])&&("function"==K(o[c]).classList.contains?(K(o[c]).classList.contains("error-card-form")&&K(o[c]).classList.remove("error-card-form"),K(o[c]).classList.contains("default-card-form")||K(o[c]).classList.add("default-card-form")):(G(K(o[c]),"error-card-form")&&F(K(o[c]),"error-card-form"),G(K(o[c]),"default-card-form")||E(K(o[c]),"default-card-form")));var d=a.Form.paymentFormDataGetErrors();for(var e in d)null!=K(o[c])&&("function"==K(o[e]).classList.contains?(K(o[e]).classList.contains("error-card-form")||K(o[e]).classList.add("error-card-form"),K(o[e]).classList.contains("default-card-form")&&K(o[e]).classList.remove("default-card-form")):(G(K(o[e]),"error-card-form")||E(K(o[e]),"error-card-form"),G(K(o[e]),"default-card-form")&&F(K(o[e]),"default-card-form")))},J=function(a,b,c){for(var d=b.split(" "),e=0;e<d.length;e++)null!=K(a)&&Q(K(a),d[e],function(a){c()},!1)},K=function(a){if(null!=a&&void 0!==a){var c="*[data-hipay-id='"+a+"']";if(b(c))return document.querySelector(c);var d="input";if(document.querySelector||alert("no selector"),b(d)){if(document.querySelector(d))return document.querySelector("input[data-hipay-id='"+a+"']");document.querySelector("img[data-hipay-id='"+a+"']")&&document.querySelector("img[data-hipay-id='"+a+"']")}}},L=function(a){if(K(a))return K(a).value},M=function(a,b){K(a)&&(K(a).value=b,K(a).blur&&K(a).blur(),K(a).focus&&K(a).focus())},N=function(a){J(a,"keydown keypress paste blur focus",I)},O=function(){for(var a in o)if(null!=K(o[a])&&""==K(o[a]).placeholder)switch(a){case"cardNumber":K(o[a]).placeholder=n("FORM_PLACEHOLDER_CARD_NUMBER");break;case"cardHolder":K(o[a]).placeholder=n("FORM_PLACEHOLDER_CARD_HOLDER");break;case"cardExpiryDate":K(o[a]).placeholder=n("FORM_PLACEHOLDER_CARD_EXPIRY_DATE");break;case"cardCVV":L(o.cardType)===p["american-express"]?K(o[a]).placeholder=n("FORM_PLACEHOLDER_CARD_CVV_AMEX"):K(o[a]).placeholder=n("FORM_PLACEHOLDER_CARD_CVV")}},P=function(a){a&&a===p["american-express"]?K(o.cardCVV).placeholder=n("FORM_PLACEHOLDER_CARD_CVV_AMEX"):K(o.cardCVV).placeholder=n("FORM_PLACEHOLDER_CARD_CVV")},Q=function(a,b,c,d){void 0!==a&&(a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,d))},R=function(){S(),T(),U(),V(),W(),X()},S=function(){var a="cardNumber";if(Y(o[a])){var b=function(a){var b=a||window.event,c=b.keyCode||b.which;8!=c&&46!=c||(C=new D,C.initCreditCardNumber(c),b.preventDefault?b.preventDefault():b.returnValue=!1),H()};Q(K(o[a]),"keydown",b,!1);var c=function(a){var b=a||window.event,c="";window.clipboardData?c=window.clipboardData.getData("Text"):b.clipboardData&&b.clipboardData.getData&&(c=a.clipboardData.getData("text/plain")),b.preventDefault?b.preventDefault():b.returnValue=!1,C=new D,C.initCreditCardNumber("",c),H()};Q(K(o[a]),"paste",c,!1);var d=function(a){setTimeout(function(){C=new D,C.initCreditCardNumber(""),H()},0)};Q(K(o[a]),"cut",d,!1);var e=function(a){var b=a||window.event,c=b.keyCode||b.which;8==c||46==c||(void 0!==b.key&&1===b.key.length&&(b.preventDefault?b.preventDefault():b.returnValue=!1,c>=48&&c<=57&&(C=new D,C.initCreditCardNumber(c))),H())};Q(K(o[a]),"keypress",e,!1);var f=function(a){var b=a||window.event;b.keyCode||b.which;b.preventDefault?b.preventDefault():b.returnValue=!1,C=new D,K(o.cardNumber).focus(),C.initCreditCardNumber(""),H()};Q(K(o[a]),"change",f,!1),N(o[a])}},T=function(){var a="cardHolder";if(Y(o[a])){var b=function(a){var b=a||window.event,c=b.keyCode||b.which;8!=c&&46!=c||(C=new D,C.initCreditCardHolder(c),b.preventDefault?b.preventDefault():b.returnValue=!1),H()};Q(K(o[a]),"keydown",b,!1);var c=function(a){var b=a||window.event,c="";window.clipboardData?c=window.clipboardData.getData("Text"):b.clipboardData&&b.clipboardData.getData&&(c=a.clipboardData.getData("text/plain")),b.preventDefault?b.preventDefault():b.returnValue=!1,C=new D,C.initCreditCardHolder("",c),H()};Q(K(o[a]),"paste",c,!1);var d=function(a){setTimeout(function(){C=new D,C.initCreditCardHolder(""),H()},0)};Q(K(o[a]),"cut",d,!1);var e=function(a){var b=a||window.event,c=b.keyCode||b.which;8==c||46==c||void 0!==b.key&&1===b.key.length&&(C=new D,C.initCreditCardHolder(c),b.preventDefault?b.preventDefault():b.returnValue=!1),H()};Q(K(o[a]),"keypress",e,!1);var f=function(a){var b=a||window.event;b.preventDefault?b.preventDefault():b.returnValue=!1,C=new D,K(o.cardHolder).focus(),C.initCreditCardHolder(""),H()};Q(K(o[a]),"change",f,!1),N(o[a])}},U=function(){var a="cardExpiryDate";if(Y(o[a])){var b=function(a){var b=a||window.event,c=b.keyCode||b.which;8!=c&&46!=c||(C=new D,C.initCreditCardExpiryDate(c),b.preventDefault?b.preventDefault():b.returnValue=!1),H()};Q(K(o[a]),"keydown",b,!1);var c=function(a){var b=a||window.event,c=b.keyCode||b.which;8==c||46==c||void 0!==b.key&&1===b.key.length&&(b.preventDefault?b.preventDefault():b.returnValue=!1,c>=48&&c<=57&&(C=new D,C.initCreditCardExpiryDate(c))),H()};Q(K(o.cardExpiryDate),"keypress",c,!1);var d=function(a){var b=a||window.event,c="";window.clipboardData?c=window.clipboardData.getData("Text"):b.clipboardData&&b.clipboardData.getData&&(c=a.clipboardData.getData("text/plain")),b.preventDefault?b.preventDefault():b.returnValue=!1,C=new D,C.initCreditCardExpiryDate("",c),H()};Q(K(o[a]),"paste",d,!1),N(o[a])}},V=function(){var a="cardCVV";if(Y(o[a])){var b=function(a){var b=a||window.event,c=b.keyCode||b.which;8!=c&&46!=c||(C=new D,C.initCreditCardCVV(c),b.preventDefault?b.preventDefault():b.returnValue=!1),H()};Q(K(o[a]),"keydown",b,!1);var c=function(a){var b=a||window.event,c=b.keyCode||b.which;void 0!==b.key&&1===b.key.length&&(b.preventDefault?b.preventDefault():b.returnValue=!1,c>=48&&c<=57&&(C=new D,C.initCreditCardCVV(c))),H()};Q(K(o[a]),"keypress",c,!1);var d=function(a){var b=a||window.event,c="";window.clipboardData?c=window.clipboardData.getData("Text"):b.clipboardData&&b.clipboardData.getData&&(c=a.clipboardData.getData("text/plain")),b.preventDefault?b.preventDefault():b.returnValue=!1,C=new D,C.initCreditCardCVV("",c),H()};Q(K(o[a]),"paste",d,!1),N(o[a])}},W=function(){var a="cardExpiryMonth";if(Y(o[a])){var b=function(a){a||window.event;if(""!=L(o.cardExpiryMonth)&&""!=L(o.cardExpiryYear)){var b=L(o.cardExpiryMonth)+" / "+L(o.cardExpiryYear).substr(2,4);C=new D,K(o.cardExpiryDate).focus(),M(o.cardExpiryDate,""),C.initCreditCardExpiryDate("",b),M(o.cardExpiryMonth,""),M(o.cardExpiryYear,""),H()}};Q(K(o[a]),"change",b,!1),N(o[a])}},X=function(){var a="cardExpiryYear";if(Y(o[a])){var b=function(a){a||window.event;if(""!=L(o.cardExpiryMonth)&&""!=L(o.cardExpiryYear)){var b=L(o.cardExpiryMonth)+" / "+L(o.cardExpiryYear).substr(2,4);C=new D,K(o.cardExpiryDate).focus(),M(o.cardExpiryDate,""),C.initCreditCardExpiryDate("",b),M(o.cardExpiryMonth,""),M(o.cardExpiryYear,""),H()}};Q(K(o[a]),"change",b,!1),N(o[a])}},Y=function(a){return null!==K(a)&&void 0!==K(a)};_initApp=function(){var a=K(o.cardNumber);if(null!=a){var b=document.createElement("img");b.className="card-type-custom",b.setAttribute("data-hipay-id",o.cardType),b.src="",b.setAttribute("style","display:none;"),b.setAttribute("style","visibility:hidden;"),a.parentNode.insertBefore(b,a.nextSibling)}var c=K(o.payButton);if(null!=c){var d=document.createElement("input");d.setAttribute("tabindex","-1"),d.setAttribute("type","tel"),d.setAttribute("style","position: absolute; left: -999em; width:1px"),d.setAttribute("id","expiration-month"),d.setAttribute("data-hipay-id","card-expiry-month"),c.parentNode.appendChild(d);var e=document.createElement("input");e.setAttribute("tabindex","-1"),e.setAttribute("type","tel"),e.setAttribute("style","position: absolute; left: -999em; width:1px"),e.setAttribute("id","expiration-year"),e.setAttribute("data-hipay-id","card-expiry-year"),c.parentNode.appendChild(e)}O(),R()},window.onload=function(){Array.prototype.filter||(Array.prototype.filter=function(a){"use strict";if(void 0===this||null===this)throw new TypeError;var b=Object(this),c=b.length>>>0;if("function"!=typeof a)throw new TypeError;for(var d=[],e=arguments[1],f=0;f<c;f++)if(f in b){var g=b[f];a.call(e,g,f,b)&&d.push(g)}return d}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a){var b=this.length>>>0,c=Number(arguments[1])||0;for(c=c<0?Math.ceil(c):Math.floor(c),c<0&&(c+=b);c<b;c++)if(c in this&&this[c]===a)return c;return-1}),document.querySelectorAll||(document.querySelectorAll=function(a){var b,c=document.createElement("style"),d=[];for(document.documentElement.firstChild.appendChild(c),document._qsa=[],c.styleSheet.cssText=a+"{x-qsa:expression(document._qsa && document._qsa.push(this))}",window.scrollBy(0,0),c.parentNode.removeChild(c);document._qsa.length;)b=document._qsa.shift(),b.style.removeAttribute("x-qsa"),d.push(b);return document._qsa=null,d}),document.querySelector||(document.querySelector=function(a){var b=document.querySelectorAll(a);return b.length?b[0]:null}),_initApp()};var Z=function(){var a=L(o.cardExpiryDate),b="",c="";if(a){var d=a.split(k);2==d.length?(b=d[0],c=d[1]):b=d[0]}return{card_number:L(o.cardNumber),card_expiry_month:b,card_expiry_year:c,card_holder:L(o.cardHolder),cvv:L(o.cardCVV),multi_use:"0",generate_request_id:"0"}};a.CVVInformation,a.getCVVInformation=function(){C=new D;var b=C.getCreditCardCVVLengthMax();void 0===b&&(b=3);var c=C.getTypeWithCardNumber(C.getCreditCardNumberValue());return a.CVVInformation={type:q[c],length:b},a.CVVInformation},a.Form.paymentFormDataGetErrors=function(){C=new D;var a=(C.validatorCreditCard(),Z()),b={},c=C.validatorCreditCardNumber(),d=C.unformatCreditCardNumber(a.card_number);""!=d&&(c.isPotentiallyValid(d)&&(c.isValid(d)||K(o.cardNumber)===document.activeElement)||(b.cardNumber=c.errorCollection[0].message));var e=C.validatorCreditCardHolder(),f=a.card_holder;void 0!==f&&""!=f&&(0==e.isPotentiallyValid(f)||0==e.isValid(f)&&K(o.cardHolder)&&K(o.cardHolder)!==document.activeElement)&&(b.cardHolder=e.errorCollection[0].message);var g=C.validatorCreditCardExpiryDate(),h=a.card_expiry_month;""!=a.card_expiry_year&&(h+=k+a.card_expiry_year),""!=h&&(g.isPotentiallyValid(h)&&(g.isValid(h)||K(o.cardExpiryDate)===document.activeElement)||(b.cardExpiryDate=g.errorCollection[0].message));var i=C.validatorCreditCardCVV(),j=a.cvv;return""!=j&&(i.isPotentiallyValid(j,d)&&(i.isValid(j)||K(o.cardCVV)===document.activeElement)||K(o.cardCVV)&&(b.cardCVV=i.errorCollection[0].message)),b},a.Form.change=function(a){H=a},a.Form.paymentFormDataIsValid=function(){var a={card_number:L(o.cardNumber),card_holder:L(o.cardHolder),cvc:L(o.cardCVV),card_expiry_date:L(o.cardExpiryDate),multi_use:"0"};return C||(C=new D),C.validatorCreditCard().isValid(a)};var _=function(a,b,c){var d=[];for(var e in b||{})if("object"==typeof a._mapping){var f=a._mapping[e];"object"==typeof f&&(value=void 0!==c?c(e,b[e])||b[e]:b[e],!x||f.propertyDescriptors.writable?a[f.name]=value:d[f.name]=v({},f.propertyDescriptors,{value:value,configurable:!0}))}x&&Object.defineProperties(a,d)};Object.defineProperty&&d()<10&&Object.defineProperty(Element.prototype,"classList",{get:function(){var a=this,b=a.className.split(" ");return b.add=function(){var c;for(i in arguments){c=!0;for(var d=0;d<b.length;d++)if(b[d]==arguments[i]){c=!1;break}c&&(a.className+=(a.className?" ":"")+arguments[i])}},b.remove=function(){a.className="";for(i in arguments)for(var c=0;c<b.length;c++)b[c]!=arguments[i]&&(a.className+=(a.className?" ":"")+b[c])},b.toggle=function(c){var d;if(!c)throw new TypeError("Failed to execute 'toggle': 1 argument required");a.className="",d=!1;for(var e=0;e<b.length;e++)b[e]!=c?(a.className+=(a.className?" ":"")+b[e],d=!1):d=!0;return d||(a.className+=(a.className?" ":"")+c),!d},b.contains=function(){var a;for(i in arguments){a=!1;for(var c=0;c<b.length;c++)if(b[c]==arguments[i]){a=!0;break}return a}},b}}),a.ErrorReason={APIIncorrectCredentials:1000001,APIIncorrectSignature:1000002,APIAccountNotActive:1000003,APIAccountLocked:1000004,APIInsufficientPermissions:1000005,APIForbiddenAccess:1000006,APIUnsupportedVersion:1000007,APITemporarilyUnavailable:1000008,APINotAllowed:1000009,APIMethodNotAllowedGateway:1010001,APIInvalidParameter:1010002,APIMethodNotAllowedSecureVault:1010003,APIInvalidCardToken:1012003,APIRequiredParameterMissing:1010101,APIInvalidParameterFormat:1010201,APIInvalidParameterLength:1010202,APIInvalidParameterNonAlpha:1010203,APIInvalidParameterNonNum:1010204,APIInvalidParameterNonDecimal:1010205,APIInvalidDate:1010206,APIInvalidTime:1010207,APIInvalidIPAddress:1010208,APIInvalidEmailAddress:1010209,APIInvalidSoftDescriptorCodeMessage:1010301,APINoRouteToAcquirer:1020001,APIUnsupportedECIDescription:1020002,APIUnsupported:1020003,APIUnknownOrder:3000001,APIUnknownTransaction:3000002,APIUnknownMerchant:3000003,APIUnsupportedOperation:3000101,APIUnknownIPAddress:3000102,APISuspicionOfFraud:3000201,APIFraudSuspicion:3040001,APIUnknownToken:3030001,APILuhnCheckFailed:409,APIUnsupportedCurrency:3010001,APIAmountLimitExceeded:3010002,APIMaxAttemptsExceeded:3010003,APIDuplicateOrder:3010004,APICheckoutSessionExpired:3010005,APIOrderCompleted:3010006,APIOrderExpired:3010007,APIOrderVoided:3010008,APIAuthorizationExpired:3020001,APIAllowableAmountLimitExceeded:3020002,APINotEnabled:3020101,APINotAllowedCapture:3020102,APINotAllowedPartialCapture:3020103,APIPermissionDenied:3020104,APICurrencyMismatch:3020105,APIAuthorizationCompleted:3020106,APINoMore:3020107,APIInvalidAmount:3020108,APIAmountLimitExceededCapture:3020109,APIAmountLimitExceededPartialCapture:3020110,APIOperationNotPermittedClosed:3020111,APIOperationNotPermittedFraud:3020112,APIRefundNotEnabled:3020201,APIRefundNotAllowed:3020202,APIPartialRefundNotAllowed:3020203,APIRefundPermissionDenied:3020204,APIRefundCurrencyMismatch:3020205,APIAlreadyRefunded:3020206,APIRefundNoMore:3020207,APIRefundInvalidAmount:3020208,APIRefundAmountLimitExceeded:3020209,APIRefundAmountLimitExceededPartial:3020210,APIOperationNotPermitted:3020211,APITooLate:3020212,APIReauthorizationNotEnabled:3020301,APIReauthorizationNotAllowed:3020302,APICannotReauthorize:3020303,APIMaxLimitExceeded:3020304,APIVoidNotAllowed:3020401,APICannotVoid:3020402,APIAuthorizationVoided:3020403,APIDeclinedAcquirer:4000001,APIDeclinedFinancialInstituion:4000002,APIInsufficientFundsAccount:4000003,APITechnicalProblem:4000004,APICommunicationFailure:4000005,APIAcquirerUnavailable:4000006,APIDuplicateTransaction:4000007,APIPaymentCancelledByTheCustomer:4000008,APIInvalidTransaction:4000009,APIPleaseCallTheAcquirerSupportCallNumber:4000010,APIAuthenticationFailedPleaseRetryOrCancel:4000011,APINoUIDConfiguredForThisOperation:4000012,APIRefusalNoExplicitReason:4010101,APIIssuerNotAvailable:4010102,APIInsufficientFundsCredit:4010103,APITransactionNotPermitted:4010201,APIInvalidCardNumber:4010202,APIUnsupportedCard:4010203,APICardExpired:4010204,APIExpiryDateIncorrect:4010205,APICVCRequired:4010206,APICVCError:4010207,APIAVSFailed:4010301,APIRetainCard:4010302,APILostOrStolenCard:4010303,APIRestrictedCard:4010304,APICardLimitExceeded:4010305,APICardBlacklisted:4010306,APIUnauthorisedIPAddressCountry:4010307,APICardnotInAuthorisersDatabase:4010309},a.Token=function(a){var b;void 0!==a&&(b=a),void 0!==a.data&&(b=a.data),_(this,$.extend({},b,{token:b.token}))},a.Token=function(){z(this)},a.Token.populateProperties=function(a,b){return _(a,b,function(a,b){}),a},a.setTarget=function(b){a.target=b,ia()},a.getTarget=function(){return a.target},a.setCredentials=function(b,c){a.username=b,a.password=c,ia()};var aa="",ba="",ca=[],da=[],ea=[];a.setAvailalblePaymentProductsCustomerCountry=function(a){aa=a,ia()},a.setAvailalblePaymentProductsCurrency=function(a){ba=a,ia()},a.enabledPaymentProducts=function(a){ca=a,ia()};var fa=function(b,c,f,g){if((void 0===g||g)&&(void 0===a.password||void 0===a.username))throw new w("missing_public_key","You have to provide a HiPay username and public key in order to perform API calls.");try{var h=window.btoa(a.username+":"+a.password)}catch(la){throw new w("missing_public_key")}"XDomainRequest"in window&&null!==window.XDomainRequest&&10!=d()&&9!=d()&&(c.Authorization="Basic "+window.btoa(a.username+":"+a.password));var i={headers:{Authorization:"Basic "+h,"Content-Type":"application/json"}};return new Promise(function(d,f){fetch(b,{method:"POST",headers:i.headers,body:JSON.stringify(c)}).then(function(a){return a.json()}).then(function(b){if(void 0!==b.code)f(new ja(b));else{var c=new a.Token(b);c.constructor.populateProperties(c,b),e(),d(c)}}).catch(function(g){fetch(b,{method:"POST",headers:i.headers,body:JSON.stringify(c)}).then(function(a){return a.json()}).then(function(b){if(void 0!==b.code)f(new ja(b));else{var c=new a.Token(b);c.constructor.populateProperties(c,b),e(),d(c)}}).catch(function(a){f(new ja(a))})})})},ga=function(){if(ea=[],da.length>0)if(ca.length>0)for(productAvailableIndex in da)for(productCustomIndex in ca)ca[productCustomIndex]==da[productAvailableIndex].code&&ea.push(da[productAvailableIndex].code);else for(productAvailableIndex in da)ea.push(da[productAvailableIndex].code)},ha=function(){if(a.getTarget()&&a.username&&a.password&&aa&&ba){var b=j.prod;"test"==a.getTarget()||"stage"==a.getTarget()?b=j.stage:"dev"==a.getTarget()&&(b="http://localhost:8080/example/dev-api-token.php");var c={eci:7,customer_country:aa,currency:ba};"XDomainRequest"in window&&null!==window.XDomainRequest&&10!=d()&&(c.Authorization="Basic "+window.btoa(a.username+":"+a.password));try{var e=window.btoa(a.username+":"+a.password)}catch(la){throw new w("missing_public_key")}var f={headers:{Authorization:"Basic "+e,Accept:"application/json"}};g=!0;var h=fetch(b,{method:"GET",headers:f.headers,data:JSON.stringify(c)});h.then(function(a){return a.json()}).then(function(a){da=a,g=!1}),h.catch(function(a){g=!1,reject(new ja(a))})}},ia=function(){ha()},v=function(){var a={},b=!1,c=0,d=arguments.length;"[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(b=arguments[0],c++);for(var e=function(c){for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(b&&"[object Object]"===Object.prototype.toString.call(c[d])?a[d]=extend(!0,a[d],c[d]):a[d]=c[d])};c<d;c++){e(arguments[c])}return a},ja=function(a){var b;void 0!==a.response.data&&(b=a.response.data),"object"==typeof b?_(this,v({},b,{code:b.code,message:b.message,description:b.description})):_(this,v({},b,{code:"code",message:"other",description:"description"}))};ja.prototype=new w,f.prototype=new w;var ka=function(a){_(this,{type:"invalid_cc_form",errorCollection:a})};return ka.prototype=new w,y(a.Token,{token:{name:"token"},requestId:{name:"request_id"},brand:{name:"brand"},pan:{name:"pan"},cardHolder:{name:"card_holder"},cardExpiryMonth:{name:"card_expiry_month"},cardExpiryYear:{name:"card_expiry_year"},issuer:{name:"issuer"},country:{name:"country"},cardType:{name:"card_type"}}),y(ja,{code:{name:"code"},message:{name:"message"}}),y(f,{code:{name:"code"},message:{name:"message"},server_response:{name:"serverResponse"}}),y(ka,{code:{name:"code"},message:{name:"message"},errorCollection:{name:"errorCollection"},server_response:{name:"serverResponse"}}),a.tokenize=function(b,c,d,e,f,g,i){var j={card_expiry_month:c,card_expiry_year:d,card_number:b,card_holder:e,cvc:f,multi_use:g,generate_request_id:i},k=new Promise(function(a,b){});if(!u())return k.reject(new ja('"message" : "cant tokenize on server side"}'));j.card_expiry_month.length<2&&(j.card_expiry_month="0"+j.card_expiry_month),2==j.card_expiry_year.length&&(j.card_expiry_year="20"+j.card_expiry_year);var l=C.validatorCreditCard();if(!1===l.isValid(j)){var m=l.errorCollection,n=new ka(m);return n.errorCollection=m,Promise.reject(n)}var o=h.production;return"test"==a.getTarget()||"stage"==a.getTarget()?o=h.stage:"dev"==a.getTarget()&&(o="http://localhost:8080/example/dev-api-token.php"),j.generate_request_id||(j.generate_request_id=0),j.multi_use||(j.multi_use=0),fa(o,j,k)},a.Form.setLocale=function(b){a.Form.locale=b},a.Form.CVVHelpText=function(){var b=new D,c=b.getCreditCardCVVLengthMax();return void 0===c&&(c=3),m[a.Form.locale]["FORM_CVV_"+c+"_HELP_MESSAGE"]},a.Form.tokenizePaymentFormData=function(){if(!a.Form.paymentFormDataIsValid())return!1;var b=L(o.cardExpiryDate),c=b.split(k),d=c[0],e="20"+c[1],f={card_number:L(o.cardNumber),card_expiry_month:d,card_expiry_year:e,
card_holder:L(o.cardHolder),cvv:L(o.cardCVV),multi_use:"0",generate_request_id:"0"};return a.tokenize(f.card_number,f.card_expiry_month,f.card_expiry_year,f.card_holder,f.cvv,f.multi_use,f.generate_request_id)},a.Form.getCardType=function(){C=new D;var a=C.getCardTypeId();for(var b in p)if(a===p[b])return b},a.Form.setCreditCardCVVMaxLength=function(a){C=new D,C.setCreditCardCVVMaxLength(a)},a.Form.initListeners=function(){R()},a.Form.initCardHolderListeners=function(){T()},a.Form.initCardExpiryDateListeners=function(){U()},a.Form.initCVVListeners=function(){V()},a.Form.initCardExpiryMonthListeners=function(){W()},a.Form.initCardExpiryYearListeners=function(){X()},a.getMappedField=function(a){return o[a]},a}(HiPay||{});